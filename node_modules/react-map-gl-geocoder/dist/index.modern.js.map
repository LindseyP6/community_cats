{"version":3,"file":"index.modern.js","sources":["../src/index.js"],"sourcesContent":["import { PureComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport MapboxGeocoder from '@mapbox/mapbox-gl-geocoder'\nimport { FlyToInterpolator } from 'react-map-gl'\nimport WebMercatorViewport from 'viewport-mercator-project'\n\nconst VALID_POSITIONS = ['top-left', 'top-right', 'bottom-left', 'bottom-right']\n\nclass Geocoder extends PureComponent {\n  geocoder = null\n  cachedResult = null\n\n  componentDidMount() {\n    this.initializeGeocoder()\n  }\n\n  componentWillUnmount() {\n    this.removeGeocoder()\n  }\n\n  componentDidUpdate() {\n    this.removeGeocoder()\n    this.initializeGeocoder()\n  }\n\n  initializeGeocoder = () => {\n    const mapboxMap = this.getMapboxMap()\n    const containerNode = this.getContainerNode()\n    const {\n      mapboxApiAccessToken,\n      inputValue,\n      origin,\n      zoom,\n      placeholder,\n      proximity,\n      trackProximity,\n      collapsed,\n      clearAndBlurOnEsc,\n      clearOnBlur,\n      bbox,\n      types,\n      countries,\n      minLength,\n      limit,\n      language,\n      filter,\n      localGeocoder,\n      reverseGeocode,\n      enableEventLogging,\n      render,\n      getItemValue,\n      onInit,\n      position\n    } = this.props\n    const options = {\n      accessToken: mapboxApiAccessToken,\n      origin,\n      zoom,\n      flyTo: false,\n      placeholder,\n      proximity,\n      trackProximity,\n      collapsed,\n      clearAndBlurOnEsc,\n      clearOnBlur,\n      bbox,\n      types,\n      countries,\n      minLength,\n      limit,\n      language,\n      filter,\n      localGeocoder,\n      reverseGeocode,\n      enableEventLogging,\n      marker: false\n    }\n\n    if (render && typeof render === 'function') {\n      options.render = render\n    }\n\n    if (getItemValue && typeof getItemValue === 'function') {\n      options.getItemValue = getItemValue\n    }\n\n    this.geocoder = new MapboxGeocoder(options)\n    this.subscribeEvents()\n\n    if (containerNode) {\n      containerNode.appendChild(this.geocoder.onAdd(mapboxMap))\n    } else {\n      mapboxMap.addControl(this.geocoder, VALID_POSITIONS.find((_position) => position === _position))\n    }\n\n    if (inputValue !== undefined && inputValue !== null) {\n      this.geocoder.setInput(inputValue)\n    } else if (this.cachedResult) {\n      this.geocoder.setInput(this.cachedResult.place_name)\n    }\n\n    if (this.cachedResult || (inputValue !== undefined && inputValue !== null)) {\n      this.showClearIcon()\n    }\n\n    onInit(this.geocoder)\n  }\n\n  showClearIcon = () => {\n    // this is a hack to force clear icon to show if there is text in the input\n    this.geocoder._clearEl.style.display = 'block'\n  }\n\n  getMapboxMap = () => {\n    const { mapRef } = this.props\n\n    return (mapRef && mapRef.current && mapRef.current.getMap()) || null\n  }\n\n  getContainerNode = () => {\n    const { containerRef } = this.props\n\n    return (containerRef && containerRef.current) || null\n  }\n\n  subscribeEvents = () => {\n    this.geocoder.on('clear', this.handleClear)\n    this.geocoder.on('loading', this.handleLoading)\n    this.geocoder.on('results', this.handleResults)\n    this.geocoder.on('result', this.handleResult)\n    this.geocoder.on('error', this.handleError)\n  }\n\n  unsubscribeEvents = () => {\n    this.geocoder.off('clear', this.handleClear)\n    this.geocoder.off('loading', this.handleLoading)\n    this.geocoder.off('results', this.handleResults)\n    this.geocoder.off('result', this.handleResult)\n    this.geocoder.off('error', this.handleError)\n  }\n\n  removeGeocoder = () => {\n    const mapboxMap = this.getMapboxMap()\n\n    this.unsubscribeEvents()\n\n    if (mapboxMap && mapboxMap.removeControl) {\n      this.getMapboxMap().removeControl(this.geocoder)\n    }\n\n    this.geocoder = null\n  }\n\n  handleClear = () => {\n    this.cachedResult = null\n    this.props.onClear()\n  }\n\n  handleLoading = (event) => {\n    this.props.onLoading(event)\n  }\n\n  handleResults = (event) => {\n    this.props.onResults(event)\n  }\n\n  handleResult = (event) => {\n    const { result } = event\n    const { onViewportChange, onResult } = this.props\n    const { bbox, center, properties = {} } = result\n    const { short_code } = properties\n    const [longitude, latitude] = center\n    const bboxExceptions = {\n      fr: {\n        name: 'France',\n        bbox: [[-4.59235, 41.380007], [9.560016, 51.148506]]\n      },\n      us: {\n        name: 'United States',\n        bbox: [[-171.791111, 18.91619], [-66.96466, 71.357764]]\n      },\n      ru: {\n        name: 'Russia',\n        bbox: [[19.66064, 41.151416], [190.10042, 81.2504]]\n      },\n      ca: {\n        name: 'Canada',\n        bbox: [[-140.99778, 41.675105], [-52.648099, 83.23324]]\n      }\n    }\n    const { width, height } = this.getMapboxMap()\n      .getContainer()\n      .getBoundingClientRect()\n    let zoom = this.geocoder.options.zoom\n    const fitBounds = (bounds, viewport) => new WebMercatorViewport(viewport).fitBounds(bounds)\n\n    try {\n      if (!bboxExceptions[short_code] && bbox) {\n        zoom = fitBounds([[bbox[0], bbox[1]], [bbox[2], bbox[3]]], { width, height }).zoom\n      } else if (bboxExceptions[short_code]) {\n        zoom = fitBounds(bboxExceptions[short_code].bbox, { width, height }).zoom\n      }\n    } catch (e) {\n      console.warn('following result caused an error when trying to zoom to bbox: ', result) // eslint-disable-line\n      zoom = this.geocoder.options.zoom\n    }\n\n    onViewportChange({\n      longitude,\n      latitude,\n      zoom,\n      transitionInterpolator: new FlyToInterpolator(),\n      transitionDuration: 3000\n    })\n    onResult(event)\n\n    this.cachedResult = result\n    this.geocoder._typeahead.selected = null\n    this.showClearIcon()\n  }\n\n  handleError = (event) => {\n    this.props.onError(event)\n  }\n\n  getGeocoder() {\n    return this.geocoder\n  }\n\n  render() {\n    return null\n  }\n\n  static propTypes = {\n    mapRef: PropTypes.object.isRequired,\n    containerRef: PropTypes.object,\n    onViewportChange: PropTypes.func,\n    mapboxApiAccessToken: PropTypes.string.isRequired,\n    inputValue: PropTypes.string,\n    origin: PropTypes.string,\n    zoom: PropTypes.number,\n    placeholder: PropTypes.string,\n    proximity: PropTypes.object,\n    trackProximity: PropTypes.bool,\n    collapsed: PropTypes.bool,\n    clearAndBlurOnEsc: PropTypes.bool,\n    clearOnBlur: PropTypes.bool,\n    bbox: PropTypes.array,\n    types: PropTypes.string,\n    countries: PropTypes.string,\n    minLength: PropTypes.number,\n    limit: PropTypes.number,\n    language: PropTypes.string,\n    filter: PropTypes.func,\n    localGeocoder: PropTypes.func,\n    reverseGeocode: PropTypes.bool,\n    enableEventLogging: PropTypes.bool,\n    render: PropTypes.func,\n    getItemValue: PropTypes.func,\n    position: PropTypes.oneOf(VALID_POSITIONS),\n    onInit: PropTypes.func,\n    onClear: PropTypes.func,\n    onLoading: PropTypes.func,\n    onResults: PropTypes.func,\n    onResult: PropTypes.func,\n    onError: PropTypes.func\n  }\n\n  static defaultProps = {\n    onViewportChange: () => {},\n    origin: 'https://api.mapbox.com',\n    zoom: 16,\n    placeholder: 'Search',\n    trackProximity: false,\n    collapsed: false,\n    clearAndBlurOnEsc: false,\n    clearOnBlur: false,\n    minLength: 2,\n    limit: 5,\n    reverseGeocode: false,\n    enableEventLogging: true,\n    position: 'top-right',\n    onInit: () => {},\n    onClear: () => {},\n    onLoading: () => {},\n    onResults: () => {},\n    onResult: () => {},\n    onError: () => {}\n  }\n}\n\nexport default Geocoder\n"],"names":["VALID_POSITIONS","Geocoder","PureComponent","geocoder","cachedResult","initializeGeocoder","mapboxMap","this","getMapboxMap","containerNode","getContainerNode","mapboxApiAccessToken","inputValue","origin","zoom","placeholder","proximity","trackProximity","collapsed","clearAndBlurOnEsc","clearOnBlur","bbox","types","countries","minLength","limit","language","filter","localGeocoder","reverseGeocode","enableEventLogging","render","getItemValue","onInit","position","props","options","accessToken","flyTo","marker","MapboxGeocoder","subscribeEvents","appendChild","onAdd","addControl","find","_position","setInput","place_name","showClearIcon","_clearEl","style","display","mapRef","current","getMap","containerRef","on","handleClear","handleLoading","handleResults","handleResult","handleError","unsubscribeEvents","off","removeGeocoder","removeControl","onClear","event","onLoading","onResults","result","onViewportChange","onResult","center","properties","short_code","longitude","latitude","bboxExceptions","fr","name","us","ru","ca","width","height","getContainer","getBoundingClientRect","fitBounds","bounds","viewport","WebMercatorViewport","e","console","warn","transitionInterpolator","FlyToInterpolator","transitionDuration","_typeahead","selected","onError","componentDidMount","componentWillUnmount","componentDidUpdate","getGeocoder","propTypes","PropTypes","object","isRequired","func","string","number","bool","array","oneOf","defaultProps"],"mappings":"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"}